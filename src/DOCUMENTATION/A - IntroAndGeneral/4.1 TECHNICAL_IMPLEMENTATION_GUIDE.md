# Intro and General: Technical Implementation Guide

## 1.0 Overview

This document provides a detailed technical implementation guide for the "Intro and General" section of the AI Twin Tech website. It includes code snippets and examples to illustrate how the key components are built.

## 2.0 Project Setup

```bash
npm create vite@latest my-app -- --template react-ts
cd my-app
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p

# Install React Router
npm install react-router-dom

# Install backend dependencies (if in a monorepo or separate backend project)
npm install express cors dotenv jsonwebtoken bcryptjs
npm install -D @types/express @types/cors @types/jsonwebtoken @types/bcryptjs
```

## 3.0 Core Components

### 3.1 App.tsx (Routing and Layout)

```tsx
import React, { useEffect } from 'react';
import { HashRouter, Routes, Route, Outlet, Navigate } from 'react-router-dom';
import { AuthProvider, useAuth } from './context/AuthContext'; // Import useAuth
import Header from './components/Header';
import Footer from './components/Footer';
import HomePage from './pages/HomePage';
import LoginPage from './pages/auth/LoginPage';
import RegisterPage from './pages/auth/RegisterPage';
// ... import other pages as needed

// AppLayout component defines the common layout for most pages
const AppLayout: React.FC = () => {
  return (
    <div className="grid grid-rows-[auto,1fr,auto] h-screen bg-gray-100 text-gray-800">
      <Header />
      <main className="overflow-y-auto min-h-0">
        <Outlet /> {/* This is where the routed components will be rendered */}
      </main>
      <Footer />
    </div>
  );
};

// ProtectedRoute example (if you want to protect routes based on authentication)
const ProtectedRoute: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const { user, loading } = useAuth(); // Assuming useAuth provides a loading state

  if (loading) {
    return <div>Loading authentication...</div>; // Or a spinner
  }

  if (!user) {
    return <Navigate to="/login" replace />; // Redirect to login if not authenticated
  }

  return <>{children}</>;
};

const App: React.FC = () => {
  return (
    <AuthProvider>
      <HashRouter>
        <Routes>
          {/* Routes using the common AppLayout */}
          <Route element={<AppLayout />}>
            <Route path="/" element={<HomePage />} />
            <Route path="/login" element={<LoginPage />} />
            <Route path="/register" element={<RegisterPage />} />
            {/* Example of a protected route */}
            {/* <Route path="/dashboard" element={<ProtectedRoute><DashboardPage /></ProtectedRoute>} /> */}
            {/* Catch-all route for unmatched paths */}
            <Route path="*" element={<Navigate to="/" replace />} />
          </Route>
        </Routes>
      </HashRouter>
    </AuthProvider>
  );
};

export default App;
```

### 3.2 Header.tsx (Navigation)

```tsx
import React from 'react';
import { Link } from 'react-router-dom';

const navLinks = [
  { id: 1, text: 'Home', href: '/' },
  { id: 2, text: 'About', href: '/about' },
  { id: 3, text: 'TwinStudio', href: '/roadmap' },
  { id: 4, text: 'TwinLab', href: '/twinlab' },
];

const Header: React.FC = () => {
  // ... component logic

  return (
    <header className="shadow-md">
      <nav>
        {navLinks.map((link) => (
          <Link key={link.id} to={link.href}>
            {link.text}
          </Link>
        ))}
      </nav>
    </header>
  );
};

export default Header;
```

### 3.3 HomePage.tsx (Content)

```tsx
import React from 'react';
import RubiksIframe from '../components/RubiksIframe';

const HomePage: React.FC = () => {
  return (
    <div className="bg-transparent">
      <section className="relative z-0">
        <RubiksIframe height="calc(100vh - 5rem)" />
      </section>
    </div>
  );
};

export default HomePage;
```

## 4.0 Authentication

### 4.1 AuthContext.tsx (Full Implementation with Persistence)

```tsx
import React, { createContext, useContext, useState, useEffect, useCallback } from 'react';
import { useNavigate } from 'react-router-dom';

interface User {
  email: string;
  // Add other user properties as needed
}

interface AuthContextType {
  user: User | null;
  loading: boolean; // To indicate if auth state is still being loaded
  login: (email: string, password: string) => Promise<void>;
  logout: () => Promise<void>;
  register: (email: string, password: string) => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const AuthProvider = ({ children }: { children: React.ReactNode }) => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true); // Initial loading state
  const navigate = useNavigate();

  // Function to load user from localStorage or validate token
  const loadUser = useCallback(async () => {
    const storedUser = localStorage.getItem('user');
    if (storedUser) {
      try {
        const parsedUser: User = JSON.parse(storedUser);
        // In a real app, you'd validate the token with your backend here
        // For this example, we'll just set the user
        setUser(parsedUser);
      } catch (error) {
        console.error("Failed to parse user from localStorage", error);
        localStorage.removeItem('user'); // Clear invalid data
        setUser(null);
      }
    }
    setLoading(false);
  }, []);

  useEffect(() => {
    loadUser();
  }, [loadUser]);

  const login = async (email, password) => {
    setLoading(true);
    try {
      const response = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      });
      const data = await response.json();

      if (response.ok) {
        const loggedInUser: User = { email: data.email }; // Assuming backend returns email
        setUser(loggedInUser);
        localStorage.setItem('user', JSON.stringify(loggedInUser)); // Persist user
        navigate('/'); // Redirect to home or dashboard
      } else {
        throw new Error(data.message || 'Login failed');
      }
    } catch (error: any) {
      console.error('Login error:', error.message);
      throw error; // Re-throw to be caught by UI components
    } finally {
      setLoading(false);
    }
  };

  const register = async (email, password) => {
    setLoading(true);
    try {
      const response = await fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      });
      const data = await response.json();

      if (response.ok) {
        const registeredUser: User = { email: data.email };
        setUser(registeredUser);
        localStorage.setItem('user', JSON.stringify(registeredUser));
        navigate('/');
      } else {
        throw new Error(data.message || 'Registration failed');
      }
    } catch (error: any) {
      console.error('Registration error:', error.message);
      throw error;
    } finally {
      setLoading(false);
    }
  };

  const logout = async () => {
    setLoading(true);
    try {
      // In a real app, you might call a backend /api/logout endpoint
      localStorage.removeItem('user');
      setUser(null);
      navigate('/login');
    } catch (error: any) {
      console.error('Logout error:', error.message);
    } finally {
      setLoading(false);
    }
  };

  const value = {
    user,
    loading,
    login,
    logout,
    register,
  };

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};
```

### 4.2 Backend Express.js Authentication Endpoints

This code assumes you have a separate `server.ts` or `app.ts` file for your Express application and a `db.ts` for database connection (e.g., using `pg` or `supabase-js` for Node.js).

```typescript
// server.ts (or app.ts) - Backend Entry Point
import express from 'express';
import cors from 'cors';
import dotenv from 'dotenv';
import bcrypt from 'bcryptjs';
import jwt from 'jsonwebtoken';
import { Pool } from 'pg'; // Assuming PostgreSQL

dotenv.config();

const app = express();
const PORT = process.env.PORT || 5000;
const JWT_SECRET = process.env.JWT_SECRET || 'supersecretjwtkey'; // Use a strong, random key in production
const SALT_ROUNDS = 10; // For bcrypt

// Configure PostgreSQL Pool
const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
});

app.use(cors());
app.use(express.json()); // Enable JSON body parsing

// --- Utility for JWT Token Generation ---
const generateToken = (userId: string, email: string) => {
  return jwt.sign({ userId, email }, JWT_SECRET, { expiresIn: '1h' });
};

// --- Authentication Middleware (Optional, for protected routes) ---
const authenticateToken = (req: any, res: any, next: any) => {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];

  if (token == null) return res.sendStatus(401); // No token

  jwt.verify(token, JWT_SECRET, (err: any, user: any) => {
    if (err) return res.sendStatus(403); // Invalid token
    req.user = user;
    next();
  });
};

// --- API Endpoints ---

// Register User
app.post('/api/register', async (req, res) => {
  const { email, password } = req.body;

  // Basic validation
  if (!email || !password) {
    return res.status(400).json({ message: 'Email and password are required' });
  }
  if (password.length < 6) {
    return res.status(400).json({ message: 'Password must be at least 6 characters long' });
  }

  try {
    // Check if user already exists
    const userExists = await pool.query('SELECT * FROM users WHERE email = $1', [email]);
    if (userExists.rows.length > 0) {
      return res.status(409).json({ message: 'User with this email already exists' });
    }

    // Hash password
    const hashedPassword = await bcrypt.hash(password, SALT_ROUNDS);

    // Save user to database
    const newUser = await pool.query(
      'INSERT INTO users (email, password_hash) VALUES ($1, $2) RETURNING id, email',
      [email, hashedPassword]
    );

    const user = newUser.rows[0];
    const token = generateToken(user.id, user.email);

    res.status(201).json({ message: 'User registered successfully', email: user.email, token });
  } catch (error) {
    console.error('Registration error:', error);
    res.status(500).json({ message: 'Internal server error during registration' });
  }
});

// Login User
app.post('/api/login', async (req, res) => {
  const { email, password } = req.body;

  // Basic validation
  if (!email || !password) {
    return res.status(400).json({ message: 'Email and password are required' });
  }

  try {
    // Find user by email
    const userResult = await pool.query('SELECT * FROM users WHERE email = $1', [email]);
    const user = userResult.rows[0];

    if (!user) {
      return res.status(401).json({ message: 'Invalid credentials' });
    }

    // Compare password
    const isMatch = await bcrypt.compare(password, user.password_hash);
    if (!isMatch) {
      return res.status(401).json({ message: 'Invalid credentials' });
    }

    // Generate token
    const token = generateToken(user.id, user.email);

    // Update last_login timestamp
    await pool.query('UPDATE users SET last_login = NOW() WHERE id = $1', [user.id]);

    res.status(200).json({ message: 'Logged in successfully', email: user.email, token });
  } catch (error) {
    console.error('Login error:', error);
    res.status(500).json({ message: 'Internal server error during login' });
  }
});

// Example of a protected route
app.get('/api/protected', authenticateToken, (req: any, res) => {
  res.json({ message: `Welcome, ${req.user.email}! This is protected data.` });
});

// Start the server
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});
```

## 5.0 Styling

### 5.1 tailwind.config.js

```js
module.exports = {
  content: ["./src/**/*.{js,jsx,ts,tsx}"],
  theme: {
    extend: {
      colors: {
        'electric-blue': {
          '400': '#3b82f6',
          '600': '#2563eb',
          '700': '#1d4ed8',
        },
      },
    },
  },
  plugins: [],
};
```
