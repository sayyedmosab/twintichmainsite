# TwinSchema Technical Architecture Diagrams

## System Architecture Overview

```mermaid
graph TB
    subgraph "User Journey Flow"
        U[User with Pain Point] --> LP[Landing Page]
        LP --> PS[Pain Selector]
        PS --> TM[Template Matcher]
        TM --> DT[Digital Twin Generator]
        DT --> AI[AI Magic Moment]
        AI --> CP[Conversion Pipeline]
    end

    subgraph "Frontend Layer"
        LP --> NextJS[Next.js 14 + TypeScript]
        NextJS --> TailwindCSS[Tailwind CSS + RTL]
        NextJS --> ReactComponents[React Components]
        ReactComponents --> UILibrary[shadcn/ui Library]
    end

    subgraph "Backend Layer"
        NextJS --> APIRoutes[API Routes]
        APIRoutes --> ExpressServer[Express Server + TypeScript]
        ExpressServer --> StorageLayer[Storage Layer]
        ExpressServer --> AIServices[AI Services]
        ExpressServer --> ChatbotManager[Chatbot Manager]
    end

    subgraph "AI Integration Layer"
        AIServices --> OpenAI[OpenAI GPT-4]
        AIServices --> Gemini[Google Gemini]
        AIServices --> NLPProcessor[Arabic/English NLP]
        OpenAI --> DTDLGeneration[DTDL Generation]
        Gemini --> ConversationAI[Contextual AI Chat]
    end

    subgraph "Data Layer"
        StorageLayer --> Supabase[(Supabase PostgreSQL)]
        Supabase --> Projects[Projects Table]
        Supabase --> Templates[Templates Table]
        Supabase --> DTDLModels[DTDL Models Table]
        Supabase --> ChatMessages[Chat Messages Table]
        Supabase --> DatabaseSchemas[Database Schemas Table]
    end

    subgraph "Infrastructure Layer"
        ExpressServer --> Vercel[Vercel Deployment]
        Supabase --> AWS[AWS Saudi Region]
        Vercel --> CDN[Global CDN]
        AWS --> DataSovereignty[Saudi Data Residency]
    end

    classDef frontend fill:#e1f5fe
    classDef backend fill:#f3e5f5
    classDef ai fill:#fff3e0
    classDef data fill:#e8f5e8
    classDef infra fill:#fce4ec

    class NextJS,TailwindCSS,ReactComponents,UILibrary frontend
    class APIRoutes,ExpressServer,StorageLayer,ChatbotManager backend
    class OpenAI,Gemini,NLPProcessor,DTDLGeneration,ConversationAI ai
    class Supabase,Projects,Templates,DTDLModels,ChatMessages,DatabaseSchemas data
    class Vercel,AWS,CDN,DataSovereignty infra
```

## Pain-to-Relief Technical Flow

```mermaid
sequenceDiagram
    participant U as User
    participant LP as Landing Page
    participant PE as Pain Engine
    participant TE as Template Engine
    participant NLE as NL Adaptation Engine
    participant AI as AI Magic Moment
    participant CE as Conversion Engine

    Note over U,CE: Phase 1: Pain Recognition (5 min)
    U->>LP: Visits landing page
    LP->>PE: Pain point selection
    PE->>PE: Smart matching algorithm
    PE->>PE: Complexity scoring
    PE-->>U: Pain profile + template recommendation

    Note over U,CE: Phase 2: Template-to-Model (10 min)
    U->>TE: Selects template
    TE->>TE: Load Saudi gov template
    TE->>TE: Generate DTDL model
    TE->>TE: Create visualization
    TE-->>U: Instant digital twin model

    Note over U,CE: Phase 3: NL Adaptation (15 min)
    U->>NLE: Describes specific context
    NLE->>NLE: Arabic/English NLP processing
    NLE->>NLE: Entity recognition
    NLE->>NLE: Real-time DTDL adaptation
    NLE-->>U: Customized organization model

    Note over U,CE: Phase 4: AI Magic Moment (5 min)
    U->>AI: Asks questions about model
    AI->>AI: Context-aware AI processing
    AI->>AI: Saudi gov knowledge base
    AI->>AI: Predictive insights
    AI-->>U: Intelligent recommendations

    Note over U,CE: Phase 5: Conversion (2 min)
    U->>CE: Requests next steps
    CE->>CE: Executive qualification
    CE->>CE: Auto-proposal generation
    CE->>CE: Calendar integration
    CE-->>U: 90-day pilot proposal
```

## Database Schema Architecture

```mermaid
erDiagram
    PROJECTS {
        uuid id PK
        text title
        text description
        varchar status
        timestamp created_at
        timestamp updated_at
    }

    DTDL_MODELS {
        uuid id PK
        uuid project_id FK
        text model_id
        text display_name
        varchar model_type
        jsonb dtdl_content
        boolean is_valid
        jsonb validation_errors
        timestamp created_at
    }

    DATABASE_SCHEMAS {
        uuid id PK
        uuid project_id FK
        varchar database_type
        text schema_content
        integer table_count
        boolean has_vector_search
        boolean has_audit_tables
        timestamp created_at
    }

    CHAT_MESSAGES {
        uuid id PK
        uuid project_id FK
        varchar role
        text content
        text sql_query
        jsonb query_results
        timestamp timestamp
    }

    TEMPLATES {
        uuid id PK
        text name
        text description
        varchar category
        varchar icon
        text template_content
        boolean is_active
    }

    PAIN_POINTS {
        uuid id PK
        text title
        text description
        varchar category
        varchar saudi_sector
        text relief_promise
        integer complexity_score
        jsonb matching_criteria
        timestamp created_at
    }

    USER_SESSIONS {
        uuid id PK
        varchar session_token
        uuid pain_point_id FK
        uuid template_id FK
        varchar conversion_stage
        jsonb journey_data
        timestamp created_at
        timestamp last_activity
    }

    PROJECTS ||--o{ DTDL_MODELS : contains
    PROJECTS ||--o{ DATABASE_SCHEMAS : generates
    PROJECTS ||--o{ CHAT_MESSAGES : has
    PAIN_POINTS ||--o{ USER_SESSIONS : triggers
    TEMPLATES ||--o{ USER_SESSIONS : uses
```

## AI Services Architecture

```mermaid
graph TD
    subgraph "AI Orchestration Layer"
        AO[AI Orchestrator] --> ChatbotFactory[Chatbot Factory]
        ChatbotFactory --> OpenAIChatbot[OpenAI Chatbot]
        ChatbotFactory --> GeminiChatbot[Gemini Chatbot]
    end

    subgraph "Core AI Services"
        DTDLService[DTDL Generation Service]
        DatabaseService[Database Schema Service]
        ChatService[Chat Processing Service]
        NLPService[NLP Processing Service]
    end

    subgraph "AI Providers"
        OpenAIAPI[OpenAI API]
        GeminiAPI[Google Gemini API]
    end

    subgraph "Saudi-Specific AI Components"
        ArabicNLP[Arabic Language Processing]
        GovKnowledge[Saudi Gov Knowledge Base]
        SectorModels[Sector-Specific Models]
        Vision2030[Vision 2030 Alignment]
    end

    AO --> DTDLService
    AO --> DatabaseService
    AO --> ChatService
    AO --> NLPService

    DTDLService --> OpenAIAPI
    DatabaseService --> OpenAIAPI
    ChatService --> OpenAIAPI
    ChatService --> GeminiAPI
    NLPService --> GeminiAPI

    NLPService --> ArabicNLP
    ChatService --> GovKnowledge
    DTDLService --> SectorModels
    ChatService --> Vision2030

    classDef orchestration fill:#fff3e0
    classDef services fill:#e8f5e8
    classDef providers fill:#e1f5fe
    classDef saudi fill:#fce4ec

    class AO,ChatbotFactory,OpenAIChatbot,GeminiChatbot orchestration
    class DTDLService,DatabaseService,ChatService,NLPService services
    class OpenAIAPI,GeminiAPI providers
    class ArabicNLP,GovKnowledge,SectorModels,Vision2030 saudi
```

## Component Architecture

```mermaid
graph TD
    subgraph "React Component Hierarchy"
        App[App.tsx] --> Header[Header Component]
        App --> WorkflowTabs[Workflow Tabs]
        
        WorkflowTabs --> DescriptionTab[Description Tab]
        WorkflowTabs --> DTDLTab[DTDL Tab]
        WorkflowTabs --> DatabaseTab[Database Tab]
        WorkflowTabs --> ChatTab[Chat Tab]
        
        DescriptionTab --> TemplateSelector[Template Selector]
        DescriptionTab --> PainPointMatcher[Pain Point Matcher]
        
        DTDLTab --> DTDLViewer[DTDL Model Viewer]
        DTDLTab --> DTDLGenerator[DTDL Generator]
        
        DatabaseTab --> SchemaViewer[Schema Viewer]
        DatabaseTab --> SchemaGenerator[Schema Generator]
        
        ChatTab --> ChatInterface[Chat Interface]
        ChatTab --> AIContextProvider[AI Context Provider]
    end

    subgraph "UI Components Library"
        shadcn[shadcn/ui] --> Button[Button]
        shadcn --> Card[Card]
        shadcn --> Tabs[Tabs]
        shadcn --> Dialog[Dialog]
        shadcn --> Form[Form]
        shadcn --> Textarea[Textarea]
        shadcn --> CodeEditor[Code Editor]
    end

    subgraph "Hooks & State Management"
        QueryClient[TanStack Query] --> APIHooks[API Hooks]
        ToastHook[Toast Hook] --> Notifications[Notifications]
        MobileHook[Mobile Hook] --> ResponsiveUI[Responsive UI]
    end

    DescriptionTab --> Button
    DTDLTab --> CodeEditor
    DatabaseTab --> CodeEditor
    ChatTab --> Form
    
    DescriptionTab --> QueryClient
    DTDLTab --> QueryClient
    DatabaseTab --> QueryClient
    ChatTab --> QueryClient

    classDef components fill:#e1f5fe
    classDef ui fill:#f3e5f5
    classDef state fill:#fff3e0

    class App,Header,WorkflowTabs,DescriptionTab,DTDLTab,DatabaseTab,ChatTab components
    class shadcn,Button,Card,Tabs,Dialog,Form,Textarea,CodeEditor ui
    class QueryClient,APIHooks,ToastHook,MobileHook state
```

## Deployment Architecture

```mermaid
graph TB
    subgraph "Development Environment"
        Dev[Developer] --> Git[Git Repository]
        Git --> GitHub[GitHub Actions CI/CD]
    end

    subgraph "Frontend Deployment"
        GitHub --> VercelBuild[Vercel Build Pipeline]
        VercelBuild --> VercelEdge[Vercel Edge Network]
        VercelEdge --> GlobalCDN[Global CDN Distribution]
    end

    subgraph "Backend Deployment"
        GitHub --> DockerBuild[Docker Container Build]
        DockerBuild --> AWSRegion[AWS Saudi Region]
        AWSRegion --> ECS[AWS ECS/Fargate]
        ECS --> LoadBalancer[Application Load Balancer]
    end

    subgraph "Database Layer"
        Supabase[(Supabase PostgreSQL)]
        SupabaseAPI[Supabase API Gateway]
        SupabaseAuth[Supabase Auth]
        
        Supabase --> SupabaseAPI
        Supabase --> SupabaseAuth
    end

    subgraph "External Services"
        OpenAIAPI[OpenAI API]
        GeminiAPI[Google Gemini API]
        SaudiGov[Saudi Gov APIs]
    end

    subgraph "Monitoring & Analytics"
        Vercel --> VercelAnalytics[Vercel Analytics]
        ECS --> CloudWatch[AWS CloudWatch]
        Supabase --> SupabaseMetrics[Supabase Metrics]
    end

    GlobalCDN --> Users[End Users]
    LoadBalancer --> SupabaseAPI
    LoadBalancer --> OpenAIAPI
    LoadBalancer --> GeminiAPI
    LoadBalancer --> SaudiGov

    classDef dev fill:#fff3e0
    classDef frontend fill:#e1f5fe
    classDef backend fill:#f3e5f5
    classDef data fill:#e8f5e8
    classDef external fill:#fce4ec
    classDef monitoring fill:#f1f8e9

    class Dev,Git,GitHub dev
    class VercelBuild,VercelEdge,GlobalCDN frontend
    class DockerBuild,AWSRegion,ECS,LoadBalancer backend
    class Supabase,SupabaseAPI,SupabaseAuth data
    class OpenAIAPI,GeminiAPI,SaudiGov external
    class VercelAnalytics,CloudWatch,SupabaseMetrics monitoring
```

## Key Architectural Patterns

### 1. **Progressive Enhancement Pattern**
- Landing page → Pain recognition → Template matching → AI enhancement → Conversion
- Each phase builds upon the previous, creating increasing engagement

### 2. **Saudi-First Design Pattern**
- Arabic language support at every layer
- Government compliance and security standards
- Vision 2030 alignment in all AI models and templates

### 3. **Dual-AI Provider Pattern**
- OpenAI for DTDL generation and technical tasks
- Google Gemini for conversational AI and Arabic processing
- Redundancy and cost optimization

### 4. **Pain-Driven Architecture Pattern**
- Every technical component serves the pain-to-relief user journey
- Data models optimized for Saudi government transformation scenarios
- AI training focused on government domain expertise

### 5. **Conversion-Optimized Pattern**
- Technical stack optimized for 3 high-quality conversions
- Executive-level features and presentation
- 90-day pilot proposal automation